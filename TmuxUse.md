# Tmux 使用指南 (AutoDL 防断连)

## 1. 为什么需要 Tmux？
在 AutoDL 或其他远程服务器上训练模型时，如果直接在终端运行代码，一旦**SSH断开**、**电脑休眠**或**网络波动**，训练任务会被立即终止（Kill）。

**Tmux (Terminal Multiplexer)** 允许你在服务器后台创建一个“永不掉线”的会话。即使你关掉电脑，第二天重新连接服务器，依然可以看到训练进度条在跑。

---

## 2. 安装 (AutoDL 环境)
在 AutoDL 的终端中执行以下命令安装：

```bash
apt-get update && apt-get install -y tmux
```

---

## 3. 核心工作流 (背下这 4 步即可)

这是最常用的“炼丹”流程：

1.  **新建会话** (开始训练前)：
    ```bash
    tmux new -s train
    # train 是你给会话起的名字，可以随便改
    ```
2.  **运行代码**：
    进入 Tmux 界面后，正常执行你的命令，例如：`python train.py`
3.  **挂起离开** (下班/关机前)：
    *   按快捷键：**`Ctrl + b`**，松手，再按 **`d`**
    *   或者直接关闭 SSH 窗口。
    *   *此时程序依然在后台运行。*
4.  **重连回去** (上班/查房)：
    ```bash
    tmux attach -t train
    ```

---

## 4. 快捷键速查表

**注意：所有快捷键都需要先按前缀键 `Ctrl + b`，松手后再按具体指令。**

### 基础会话管理
| 操作 | 命令/快捷键 | 说明 |
| :--- | :--- | :--- |
| **新建会话** | `tmux new -s <名字>` | 推荐给会话起名，方便管理 |
| **查看列表** | `tmux ls` | 查看当前后台有哪些会话 |
| **进入会话** | `tmux attach -t <名字>` | 回到指定的会话中 |
| **暂时离开** | `Ctrl+b` 然后 `d` | Detach，程序继续跑，人离开 |
| **删除会话** | `tmux kill-session -t <名字>` | **警告**：会彻底结束该会话内的所有进程 |

### 分屏操作 (Panes)
用于一边看显卡监控，一边跑代码。

| 操作 | 快捷键 |
| :--- | :--- |
| **左右分屏** | `Ctrl+b` 然后 `%` (Shift+5) |
| **上下分屏** | `Ctrl+b` 然后 `"` (Shift+') |
| **切换光标** | `Ctrl+b` 然后 `方向键` |
| **关闭分屏** | `Ctrl+b` 然后 `x` (按 y 确认)，或直接输 `exit` |

### 窗口操作 (Windows)
类似浏览器的多标签页。

| 操作 | 快捷键 |
| :--- | :--- |
| **新建窗口** | `Ctrl+b` 然后 `c` |
| **切换窗口** | `Ctrl+b` 然后 `数字键` (0,1,2...) |
| **下一个窗口** | `Ctrl+b` 然后 `n` |
| **上一个窗口** | `Ctrl+b` 然后 `p` |

---

## 5. 常见问题

### Q1: 怎么在 Tmux 里翻页查看上面的日志？
Tmux 默认不能直接用鼠标滚轮翻页。
*   **进入翻页模式**：按 `Ctrl+b` 然后按 `[`
*   **操作**：使用 `方向键` 或 `PageUp/PageDown` 翻页。
*   **退出**：按 `q` 回到命令行。

### Q2: 想要用鼠标点击切换分屏？
可以通过修改配置文件开启鼠标支持。
1.  在终端输入：`vim ~/.tmux.conf`
2.  按 `i` 进入编辑模式，粘贴这一行：
    ```text
    set -g mouse on
    ```
3.  按 `Esc`，输入 `:wq` 保存退出。
4.  让配置生效：在 Tmux 内按 `Ctrl+b` 然后输入 `:source ~/.tmux.conf`
    *   *现在你可以用鼠标调整分屏大小和滚动日志了。*

### Q3: 训练完了，怎么关掉 Tmux？
在 Tmux 会话内输入 `exit` 或者按 `Ctrl+d`，直到所有窗口关闭，会话就会自动结束。

---

## 6. 常用命令总结
```bash
# 1. 安装
apt-get update && apt-get install -y tmux

# 2. 常用连招
tmux new -s my_exp   # 开启
# ... 跑代码 ...
# Ctrl+b, d          # 离开
tmux attach -t my_exp # 回来